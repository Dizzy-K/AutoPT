# CVE-2018-12613 PHPmyadmin文件包含漏洞分析及漏洞利用

漏洞描述
  在4.8.2之前的phpMyAdmin 4.8.x中发现了一个问题，攻击者可以在其中包含（查看并可能执行）服务器上的文件。该漏洞来自页面重定向和在phpMyAdmin中加载的部分代码，以及对列入白名单的页面的不正确测试。除“ $ cfg [‘AllowArbitraryServer’] = true”情况（攻击者可以指定他/她已经控制的任何主机，并在phpMyAdmin上执行任意代码）外，攻击者还必须经过身份验证。 [‘ServerDefault’] = 0“的情况（绕过登录要求，并在没有任何身份验证的情况下运行易受攻击的代码）。

影响版本

phpMyAdmin 4.8.0和4.8.1

漏洞环境搭建

使用vulhub直接docker一键启动环境CVE-2018-12613环境
docker快速入门以及漏洞环境搭建
下载安装好vulhub后进入/phpmyadmin/CVE-2018-12613目录，执行以下命令启动环境
sudo docker-compose up -d
查看当前虚拟机ip，并访问8080端口，即可出现phpmyadmin页面
漏洞分析

查看index.php中的61行，存在一个include文件包含函数

判断target是否存在
判断target是否是字符串
target不能以index字符串开头
targer不在$target_blacklist数组中
带入targer到Core类的checkPageValidity方法中
$target_blacklis数组为以下两个文件名：
查看libraries/classes/Core.php文件，查看443行，分析checkPageValidity方法用法：
在25行可以查看$whiltlist数组中存入了哪些变量：
再回到checkPageValidity方法主要查看以下代码：
```
$_page = mb_substr(
	$page,
	0,
	mb_strpos($page . '?', '?')
);
	 if (in_array($_page, $whitelist)) {
		 return true;
 }
```
这段代码会截取target变量中的字符串从开始到?中的字符，然后带入$whitelist数组中匹配，如果匹配成功，返回true。

构造payload：
```
?target=sql.php?/../../../../../../../../../etc/passwd
```
可以成功包含passwd文件

